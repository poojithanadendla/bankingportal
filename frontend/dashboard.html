<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard</title>
</head>
<body>
  <h2>Welcome to Saraswat Bank</h2>
  <button onclick="logout()">Logout</button>

  <h3>Account Info</h3>
  <div id="account"></div>

  <h3>Transfer Funds</h3>
  <input id="to_user" placeholder="Transfer To Username" />
  <input id="amount" type="number" placeholder="Amount" />
  <button onclick="transfer()">Transfer</button>

  <h3>Transaction History</h3>
  <ul id="transactions"></ul>

  <script>
    const username = localStorage.getItem('username');
    if (!username) {
      alert('Not logged in!');
      window.location.href = 'index.html';
    }

    function fetchAccount() {
      fetch(`http://127.0.0.1:5000/api/account/${username}`)
        .then(res => res.json())
        .then(data => {
          document.getElementById('account').innerHTML = `
            Name: ${data.profile.name} <br/>
            Email: ${data.profile.email} <br/>
            Balance: ₹${data.balance}
          `;
        });
    }

    function fetchTransactions() {
      fetch(`http://127.0.0.1:5000/api/transactions/${username}`)
        .then(res => res.json())
        .then(data => {
          const list = document.getElementById('transactions');
          list.innerHTML = '';
          data.forEach(tx => {
            let desc = tx.type === 'debit' ? `Sent ₹${tx.amount} to ${tx.to}` : `Received ₹${tx.amount} from ${tx.from}`;
            list.innerHTML += `<li>${desc}</li>`;
          });
        });
    }

    function transfer() {
      const to_user = document.getElementById('to_user').value;
      const amount = parseFloat(document.getElementById('amount').value);

      if (!to_user || !amount) {
        alert('Enter valid recipient and amount');
        return;
      }

      fetch('http://127.0.0.1:5000/api/transfer', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({from_user: username, to_user, amount})
      })
      .then(res => res.json())
      .then(data => {
        alert(data.message);
        fetchAccount();
        fetchTransactions();
      });
    }

    function logout() {
      localStorage.removeItem('username');
      window.location.href = 'index.html';
    }

    // Load data on page load
    fetchAccount();
    fetchTransactions();
  </script>
</body>
</html>
